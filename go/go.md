

---

## Go 应用代码更新操作文档

### A 方法：通过 1Panel 界面更新 (推荐)

如果您是按照教程，通过 1Panel 的 **“应用” -> “创建应用”** 功能部署的，请使用此方法。这是最简单、最安全、最快捷的更新方式。

#### **第一步：在线修改代码**

1.  登录您的 1Panel。
2.  点击左侧菜单栏的 **“文件”**。
3.  在文件浏览器中，找到并进入您的项目源代码目录（例如：`/opt/go-proxy-gh/`）。
4.  找到 `main.go` 文件，点击文件名或右侧的编辑按钮，进入在线编辑器。
5.  对代码进行您需要的修改。
6.  修改完成后，点击右上角的 **“保存”** 按钮。

#### **第二步：重新构建应用**

1.  代码保存后，点击左侧菜单栏的 **“应用”**。
2.  在应用列表中，找到您创建的 Go 应用（例如：`go-proxy-gh`）。
3.  点击该应用的**名称**，进入应用详情页面。
4.  在页面顶部的操作栏中，找到并点击 **“重新构建”** 按钮。
    !image [<sup>1</sup>](https://user-images.githubusercontent.com/18796515/285559384-5f50f0e8-0744-4e94-9642-fe0cf63c1a2f.png)
5.  面板会弹出一个确认窗口，再次点击 **“确认”**。

此时，1Panel 会自动拉取您刚刚修改的最新代码，然后执行 Dockerfile 里的所有指令（重新编译、打包），最后平滑地用新版应用替换掉旧版应用。整个过程是自动化的。

#### **第三步：验证更新**

1.  在应用详情页，可以点击 **“日志”** 选项卡，查看新应用启动时的输出信息，确认没有报错。
2.  等待应用状态变为 **“已启动”**，即可访问您的网站，验证新功能是否生效。

---

### B 方法：通过命令行 (Docker) 更新

如果您是跳过了 1Panel 的应用列表，直接通过 SSH 登录服务器，使用 `docker build` 和 `docker run` 命令部署的，请使用此方法。

#### **第一步：修改代码**

您可以选择以下任意一种方式修改代码：

*   **方式一 (推荐)**：使用 1Panel 的 **“文件”** 功能，在线编辑并保存 `main.go`，如 A 方法第一步所述。
*   **方式二**：通过 SSH 登录服务器，使用命令行编辑器（如 `nano` 或 `vim`）修改文件。
    ```bash
    # 进入项目目录
    cd /opt/go-proxy-gh
    # 使用 nano 编辑器打开文件
    nano main.go
    # 编辑后，按 Ctrl+X, 然后按 Y, 最后按 Enter 保存退出
    ```

#### **第二步：重新构建 Docker 镜像**

1.  通过 SSH 登录服务器。
2.  进入您的项目源代码目录。
    ```bash
    cd /opt/go-proxy-gh
    ```
3.  执行 `docker build` 命令，构建一个新的镜像。**请务必使用和之前完全相同的镜像名称**，新镜像会覆盖旧的 `latest` 标签。
    ```bash
    # `go-proxy-gh-image` 是我们之前为镜像起的名字
    docker build -t go-proxy-gh-image .
    ```
    等待命令执行完毕，看到 `Successfully tagged ...` 即表示构建成功。

#### **第三步：停止并删除旧的容器**

为了使用新镜像，需要先移除正在运行旧代码的容器。

1.  **停止**当前运行的容器（`my-go-proxy-container` 是我们之前为容器起的名字）。
    ```bash
    docker stop my-go-proxy-container
    ```
2.  **删除**这个已经停止的容器，以便释放端口和名称。
    ```bash
    docker rm my-go-proxy-container
    ```
    > **快捷操作**：您也可以使用 `docker rm -f my-go-proxy-container` 一条命令强制停止并删除容器。

#### **第四步：使用新镜像启动新容器**

1.  执行与初次部署时完全相同的 `docker run` 命令。Docker 会自动寻找最新的 `go-proxy-gh-image` 镜像来启动。
    ```bash
    docker run -d -p 8080:8080 --name my-go-proxy-container --restart always go-proxy-gh-image
    ```
    执行后，您的应用就完成了更新，并已在后台运行。

---

### 总结

*   **1Panel 界面更新** 是首选，它将命令行的多个步骤集成为一个“重新构建”按钮，既简单又不易出错。
*   **命令行更新** 提供了更高的灵活性，适用于熟悉 Docker 命令的用户或自动化CI/CD脚本。

请将此文档保存好，以便未来进行维护和更新。